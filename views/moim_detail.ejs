<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ìƒì„¸í˜ì´ì§€</title>
  </head>
  <link rel="stylesheet" href="/static/moim_detail.css" type="text/css" />
  <script
    src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
    crossorigin="anonymous"
  ></script>
  <script src="/static/moim_detail.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ìƒì„¸í˜ì´ì§€</title>
  </head>
  <link rel="stylesheet" href="/static/moim_detail.css" type="text/css" />
  <script
    src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
    crossorigin="anonymous"
  ></script>
  <script src="/static/moim_list.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <body>
    <header>
      <div class="logo">
        <!-- ë¡œê³  -->
        <a href="/">MOiM</a>
      </div>
      <div class="setting">
        <div><span>Ã—</span></div>
      </div>
    </header>
    <section>
      <div class="moim">
        <img src="#" alt="" /><br />
        <h3>ëª¨ì„ ì œëª© : <%= moim[0].title %></h3>
        <!-- <div class="moim_info">
        <div class="element">
            <div>ì¥ì†Œ</div>
            <div>ì¼ì‹œ</div>
            <div>ëª¨ì§‘ ê¸°ê°„</div>
            <div>ì¸ì›</div>
        </div>
        <div class="content">
            <div>ì¸ì²œê´‘ì—­ì‹œ</div>
            <div>2024.11.15</div>
          <div>2024.11.01 ~ 2024.11.10</div>
          <div>3/10</div>
        </div>
      </div> -->
        <table>
          <tbody>
            <tr>
              <td id="col1">ì¥ì†Œ</td>
              <td id="col2"><%= moim[0].location %></td>
            </tr>
            <tr>
              <td id="col1">ì£¼ì œ</td>
              <td id="col2"><%= moim[0].category %></td>
            </tr>
            <tr>
              <td id="col1">ì˜¨ë¼ì¸ ì—¬ë¶€</td>
              <td id="col2">
                <% if (moim[0].on_line == true) { %> ì˜¨ë¼ì¸ <% } %> <% if
                (moim[0].on_line == false) { %> ì˜¤í”„ë¼ì¸ <% } %>
              </td>
            </tr>

            <tr>
              <td id="col1">ì¼ì‹œ</td>
              <td id="col2"><%= moim[0].even_date %></td>
            </tr>
            <tr>
              <td id="col1">ëª¨ì§‘ ê¸°ê°„</td>
              <td id="col2"><%= moim[0].expiration_date %> ê¹Œì§€ ëª¨ì§‘í•©ë‹ˆë‹¤.</td>
            </tr>
            <tr>
              <td id="col1">ëª¨ì§‘ ì¸ì›</td>
              <td id="col2">
                <span>
                  <%= moimcount[0].moim_count %> /<%= moim[0].max_people
                  %></span
                ><button type="button" onclick="showPPL()">ğŸ‘¥</button>
              </td>
            </tr>
            <!-- ì°¸ì—¬í•˜ëŠ” ê²½ìš° detail ì •ë³´ ì¶”ê°€ -->
            <% if (accession == true) { %>
            <tr>
              <td id="col1">ëª¨ì„ì´ ì§„í–‰ë˜ëŠ” ìµœì†Œ ì¸ì› ìˆ˜</td>
              <td id="col2"><%= detail[0].min_people %></td>
            </tr>
            <tr>
              <td id="col1">ë‚´ìš©</td>
              <td id="col2"><%= detail[0].content %></td>
            </tr>
            <% if (moim[0].nickname == user.nickname ) { %>
            <button
              class="apply1"
              onclick="moim_distory('<%=moim[0].nickname%>', '<%=moim[0].moim_id%>')"
            >
              ëª¨ì„ ì‚­ì œ
            </button>
            <button class="apply2" onclick="moimset()">ëª¨ì„ ìˆ˜ì •</button>
            <% } else { %>
            <button class="apply" onclick="moimset_dis('<%=moim[0].moim_id%>')">
              ëª¨ì„ íƒˆí‡´
            </button>
            <% } %> <% } else { %> <% if (moimcount[0].moim_count <
            moim[0].max_people) { %>
            <button class="apply" onclick="moimset('<%=moim[0].moim_id%>')">
              ì°¸ì—¬í•˜ê¸°
            </button>
            <% } else {%>
            <div class="apply">ì •ì› ì´ˆê³¼</div>
            <% } %> <% } %>
          </tbody>
        </table>
        <br />
        <br />
        <br />
        <br />
      </div>
    </section>

    <script>
      async function moimset(moim_id) {
        //ì™„ì„±
        let { data } = await axios({
          method: "POST",
          url: "/moim/moimset",
          data: { moim_id },
        });
        if (data.result) {
          alert("ëª¨ì„ì— ì°¸ì—¬í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.");
          window.location.reload();
        } else {
          alert("ëª¨ì„ì— ê°€ì…í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
      }
      async function moimset_dis(moim_id) {
        if (confirm("ì •ë§, ëª¨ì„ì—ì„œ íƒˆí‡´í•˜ì‹¤ ê²ë‹ˆê¹Œ?")) {
          let { data } = await axios({
            method: "DELETE",
            url: "/moim/moimset",
            data: { moim_id },
          });

          if (data.result) {
            alert("ë‹¤ìŒë²ˆì—” í•¨ê»˜ í•´ì£¼ì…¨ìœ¼ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤ã… ã… ã… ã… ã… ");
            window.location.reload();
          } else {
            alert("ëª¨ì„ì„ íƒˆí‡´í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
          }
        }
      }
      async function moim_distory(nickname, moim_id) {
        if (confirm("ì •ë§, ëª¨ì„ì„ ì‚­ì œí•˜ì‹¤ ê²ë‹ˆê¹Œ?")) {
          let { data } = await axios({
            method: "DELETE",
            url: "/moim/moims",
            data: { nickname, moim_id },
          });
          if (data.result) {
            alert("ëª¨ì„ì´ ì •ìƒì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
            window.location.href = "/moim/moim_list";
          }
        }
      }
    </script>
  </body>
</html>
