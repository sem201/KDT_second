<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>μƒμ„Ένμ΄μ§€</title>
  </head>
  <link rel="stylesheet" href="/static/moim_detail.css" type="text/css" />
  <script
    src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
    crossorigin="anonymous"
  ></script>
  <script src="/static/moim_detail.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>μƒμ„Ένμ΄μ§€</title>
  </head>
  <link rel="stylesheet" href="/static/moim_detail.css" type="text/css" />
  <script
    src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
    crossorigin="anonymous"
  ></script>
  <script src="/static/moim_list.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>μƒμ„Ένμ΄μ§€</title>
</head>
<link rel="stylesheet" href="/static/style.css" type="text/css" />
<link rel="stylesheet" href="/static/moim_detail.css" type="text/css" />
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<script src="/static/moim_detail.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<body>
  <header>
    <div class="logo">
      <!-- λ΅κ³  -->
      <a href="/">MOiM</a>
    </div>
    <div class="setting">
        <div>
            <span onclick="location.href='/moim/moims'">β†</span>
        </div>
    </div>
  </header>
  <section>
    <div class="moim">
      <img src="#" alt=""><br>
      <div style="width: 80vw; display: flex; justify-content: space-between;">
      <h3><%= moim[0].title %></h3>
      <button class="dibsMoim" onclick="DibsMoim()">β™΅</button>
        </div>
      </div>
        <table>
          <tbody>
            <tr>
                <td id="col1">μ¥μ†</td>
                <td id="col2"><%= moim[0].location %></td>
            </tr>
            <tr>
                <td id="col1">μΌμ‹</td>
                <td id="col2"><%= moim[0].even_date %></td>
            </tr>
            <tr>
                <td id="col1">λ¨μ§‘ κΈ°κ°„</td>
                <td id="col2"><%= moim[0].expiration_date %></td>
            </tr>

            <tr>
                <td id="col1">λ¨μ§‘ μΈμ›</td>
                <td id="col2"><span><%= detail[0].min_people %> ~ <%= moim[0].max_people %></span><button type="button" onclick="showPPL()">π‘¥ <%= moimcount[0].moim_count %> </button></td>
            </tr>
            <!-- μ°Έμ—¬ν•λ” κ²½μ° detail μ •λ³΄ μ¶”κ°€ -->
            <% if (accession == true) { %>
            <tr>
              <td id="col1">λ‚΄μ©</td>
              <td id="col2"><%= detail[0].content %></td>
            </tr>

            <% if (moim[0].nickname == user.nickname ) { %>
            <button
              class="apply1"
              onclick="moim_distory('<%=moim[0].nickname%>', '<%=moim[0].moim_id%>')"
            >
              λ¨μ„ μ‚­μ 
            </button>
            <button class="apply2" onclick="moimset()">λ¨μ„ μμ •</button>
            <% } else { %>
            <button class="apply" onclick="moimset_dis('<%=moim[0].moim_id%>')">
              λ¨μ„ νƒν‡΄
            </button>
            <% } %> <% } else { %> <% if (moimcount[0].moim_count <
            moim[0].max_people) { %>
            <button class="apply" onclick="moimset('<%=moim[0].moim_id%>')">
              μ°Έμ—¬ν•κΈ°
            </button>
            <% } else {%>
            <div class="apply">μ •μ› μ΄κ³Ό</div>
            <% } %> <% } %>
          </tbody>
        </table>
        <br />
        <br />
        <br />
        <br />
      </div>
  </section>
</body>
    <script>
      async function moimset(moim_id) {
        //μ™„μ„±
        let { data } = await axios({
          method: "POST",
          url: "/moim/moimset",
          data: { moim_id },
        });
        if (data.result) {
          alert("λ¨μ„μ— μ°Έμ—¬ν•΄μ£Όμ…”μ„ κ°μ‚¬ν•©λ‹λ‹¤.");
          window.location.reload();
        } else {
          alert("λ¨μ„μ— κ°€μ…ν•  μ μ—†μµλ‹λ‹¤.");
        }
      }
      async function moimset_dis(moim_id) {
        if (confirm("μ •λ§, λ¨μ„μ—μ„ νƒν‡΄ν•μ‹¤ κ²λ‹κΉ?")) {
          let { data } = await axios({
            method: "DELETE",
            url: "/moim/moimset",
            data: { moim_id },
          });

          if (data.result) {
            alert("λ‹¤μλ²μ—” ν•¨κ» ν•΄μ£Όμ…¨μΌλ©΄ μΆ‹κ² μµλ‹λ‹¤γ… γ… γ… γ… γ… ");
            window.location.reload();
          } else {
            alert("λ¨μ„μ„ νƒν‡΄ν•  μ μ—†μµλ‹λ‹¤.");
          }
        }
      }
      async function moim_distory(nickname, moim_id) {
        if (confirm("μ •λ§, λ¨μ„μ„ μ‚­μ ν•μ‹¤ κ²λ‹κΉ?")) {
          let { data } = await axios({
            method: "DELETE",
            url: "/moim/moims",
            data: { nickname, moim_id },
          });
          if (data.result) {
            alert("λ¨μ„μ΄ μ •μƒμ μΌλ΅ μ‚­μ λμ—μµλ‹λ‹¤.");
            window.location.href = "/moim/moim_list";
          }
        }
      }
    </script>
  </body>
</html>
